@model Models.Activity
@using System.Web.Script.Serialization
@{
    Layout = "~/Views/Shared/_Layout.cshtml";
    List<Models.Activity> list = ViewBag.List;
    JavaScriptSerializer ser = new JavaScriptSerializer();
}

<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD-QMP7jgNjmhMSB89p96_Anlw1YDx0RmM&callback=initMap"
        async defer>
</script>
<script>
function initMap() {
    var mapDiv = document.getElementById('map');
    var mapOptions = {
        center: { lat: 57.048820, lng: 9.921747 },
        zoom: 14,
        streetViewControl: false,
        mapTypeControl: false,
        mapTypeId: google.maps.MapTypeId.HYBRID,
        editable: true
    };
    map = new google.maps.Map(mapDiv, mapOptions);
}

//This function adds the marks to an array and draws all the array to the map.
function AddMarkers(array) {
    clearOverlay();  //delete old markers
    //for-loop that iterates through the parameter-array and adds the markes from the array to the map.
    for (var i = 0; i < array.length; i++) {
        var latlng = new google.maps.LatLng(array[i].Coords.Y, array[i].Coords.X);
        var marker = new google.maps.Marker({
            position: latlng,
            map: map
        });

        //bounds.extend(marker.position);
        markers.push(marker);
    }

    for (var i = 0; i < latlngList.length; i++)
    {
        bounds.extend(latlngList[i]);
    }

    setMapOnAll(map); //add markers to map
    showMarkers(); // show markers on map

    //map.panToBounds(bounds);
}

//This function is clearing the map, using another method to null the array and clear map
function clearOverlay() {
    clearMarkers();
    deleteMarkers();
}

// Sets the map on all markers in the array.
function setMapOnAll(map) {
    for (var i = 0; i < markers.length; i++) {
        markers[i].setMap(map);
    }
}

// Removes the markers from the map, but keeps them in the array.
function clearMarkers() {
    setMapOnAll(null);
}

// Shows any markers currently in the array.
function showMarkers() {
    setMapOnAll(map);
}

// Deletes all markers in the array by removing references to them.
function deleteMarkers() {
    clearMarkers();
    markers = [];
}
    </script>
<h2>Activity</h2>

@*Creating the table in a div to ensure the table placement in the bootstrap gridview.*@
<div id="table" class="col-1 col-md-6">
    @*Creating a table with the table and hover-css motifications*@
    <table class="table text-left table-hover">
        <thead>
            <tr>
                <th class="text-left">Navn</th>
                <th class="text-left">Beskrivelse</th>
                <th class="text-left">Turens længde</th>
                <th class="text-left">Oprettet af</th>
            </tr>
        </thead>
        <tbody>
            @*Looping through the list of activities and adding the items to the table.*@
            @foreach (var item in list)
            {
                <tr onclick="AddMarkers(@ser.Serialize(item.Route.PointList))">
                    <td>@item.Name</td>
                    <td>@item.Description</td>
                    <td>@item.Distance</td>
                    <td>@item.UserID</td>
                </tr>
            }
        </tbody>

    </table>
</div>

@*A div to run a script(our initMap script) on googlemaps-api to create the map with the specific options.*@
<div style="width:100%; height:100%">
    <div id="map"></div>
</div>

